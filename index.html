<!DOCTYPE html>
<html>
    <head>
        <title>the lol shmup</title>
        <style>
            canvas {
                border: 1px solid black;
            }
        </style>
        <script>
//headers

var GAME = {
    canvas: document.createElement("canvas"),
    start: function(){
        this.canvas.width = 1200;
        this.canvas.height = 600;
        this.context = this.canvas.getContext("2d");
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
    },
    activate: function(){
        this.interval = setInterval(main, 20);
        GAME.DATE = new Date();
        this.isPaused = false;
        console.log("Nuclear Cuke");
    },
    pause: function(){
        clearInterval(this.interval);
        this.isPaused = true;
        for(var i = 0; i < musics.length; i++){
            musics[i].pause();
        }
    },
    clear: function(){
        this.context.clearRect(0, 0, this.canvas.width * 2, this.canvas.height * 2);
    },
    frameCount: 0,
    gravity: 1,
    friction: 0.9,
    level: 1,
    difficulty: 0,
    camera: {x:0, y:0},
    debugMode: false,
    isPaused: true,
    DATE: new Date(),
}
function colorToList(color){
    return [
        parseInt(color.slice(1, 3), 16),
        parseInt(color.slice(3, 5), 16),
        parseInt(color.slice(5, 7), 16)];
}
function listToColor(color){
    return "#" + ("0"+(Number(color[0]).toString(16))).slice(-2).toUpperCase() +
                ("0"+(Number(color[1]).toString(16))).slice(-2).toUpperCase() +
                ("0"+(Number(color[2]).toString(16))).slice(-2).toUpperCase();
}

var sounds = {
    pew: new Audio("pew.ogg"),
    laserPew: new Audio("laserpew.ogg"),
    hit: new Audio("hit.ogg"),
    hurt: new Audio("hurt.ogg"),
    wind: new Audio("wind.ogg"),
    boom: new Audio("boom.ogg"),
    mehPew: new Audio("mehpew.ogg"),
    weirdPew: new Audio("weirdpew.ogg"),
    shieldStart: new Audio("shieldstart.ogg"),
    shieldBlock: new Audio("shieldhit.ogg"),
    rush: new Audio("rush.ogg"),
    uwu: new Audio("uwu.ogg"),
    bossDeath: new Audio("bossdeath.ogg"),
    collect: new Audio("winning.ogg"),
    pause: new Audio("pause.ogg")
}
var musics = [
	new Audio("A_Melancholy_Autumn.ogg"), //Level 1 music
	new Audio("Urban_Groove.ogg"), //Level 2 music
];
for(var i = 0; i < musics.length; i++){
	musics[i].loop = true;
}

function Entity(X, Y, W, H){
    this.pPosition = {x: X, y: Y};
    this.position = {x: X, y: Y};
    this.velocity = {x: 0, y: 0};
    this.width = W;
    this.height = H;
    this.dead = false;
    this.rotation = 0;
    this.invinciTimer = 0;
}
Entity.prototype.move = function(){
    this.position.x += this.velocity.x;
    this.position.y += this.velocity.y;
}
Entity.prototype.applyFriction = function(){
    this.velocity.x *= GAME.friction;
    this.velocity.y *= GAME.friction;
}
Entity.prototype.applyGravity = function(){
    this.velocity.y += GAME.gravity;
}
Entity.prototype.draw = function(){
    var CTX = GAME.context;
    CTX.fillStyle = "#FF0000";
    CTX.fillRect(0, 0, this.width, this.height);
    CTX.restore();
}
Entity.prototype.applyForce = function(x, y){
    this.velocity.x += x;
    this.velocity.y += y;
}
Entity.prototype.collides = function(obj){
    if(obj instanceof Entity){
        return (this.position.x + this.width > obj.position.x &&
            this.position.x < obj.position.x + obj.width &&
            this.position.y + this.height > obj.position.y &&
            this.position.y < obj.position.y + obj.height);
    }
    return false;
}
Entity.prototype.centerPosition = function(){
    var CTX = GAME.context;
    CTX.save();
    CTX.translate(this.position.x - GAME.camera.x,
                this.position.y - GAME.camera.y);
    CTX.rotate(this.rotation);
}
Entity.prototype.onScreen = function(){
    return (this.position.x - GAME.camera.x + this.width > 0 &&
    this.position.x - GAME.camera.x < GAME.canvas.width &&
    this.position.y - GAME.camera.y + this.height > 0 &&
    this.position.y - GAME.camera.y < GAME.canvas.height);
}
Entity.prototype.interact = function(obj){ /*method stub*/ }
Entity.prototype.whenHit = function(obj){ /*method stub*/ }

function Text(X, Y, TEXT, size=20, color=[0, 0, 0], duration=80){
    Entity.call(this, X, Y, 0, 0);
    this.text = TEXT;
    this.size = size;
    this.color = color;
    this.duration = duration;
    this.delayTimer = duration;
}
Text.prototype = Object.create(Entity.prototype);
Text.prototype.draw = function(){
    var CTX = GAME.context;
    CTX.globalAlpha = (this.delayTimer/this.duration);
    CTX.fillStyle = listToColor(this.color);
    CTX.font = this.size + "px Tahoma";
    CTX.textAlign = "center";
    CTX.fillText(this.text, this.position.x, this.position.y);
    CTX.globalAlpha = 1;
}
Text.prototype.update = function(){
    if(this.delayTimer <= 0){
        this.dead = true;
    }
    this.delayTimer--;
}

function Particle(X, Y, W, H, color, duration=10){
    Entity.call(this, X, Y, W, H);
    this.color = color;
    this.duration = duration;
    this.velocity = {x: 0, y: 0};
    this.angularVelocity = Math.random() * 10 - 5;
}
Particle.prototype = Object.create(Entity.prototype);
Particle.prototype.setDuration = function(frames){ this.duration = frames; }
Particle.prototype.setVelocity = function(xVel, yVel){ this.velocity = {x: xVel, y: yVel}; }
Particle.prototype.setAngularVelocity = function(r){ this.angularVelocity = r; }
Particle.prototype.update = function(){
    this.move();
    this.applyFriction();
    this.angularVelocity *= GAME.friction;
    this.draw();
    if(this.duration <= 0){
        this.dead = true;
    }
    this.rotation += this.angularVelocity;
    this.duration--;
}
Particle.prototype.draw = function(){
    var CTX = GAME.context;
    this.centerPosition();
    CTX.fillStyle = listToColor(this.color);
    CTX.fillRect(0, 0, this.width, this.height);
    CTX.restore();
}

function Bullet(X, Y, W, H, color=[0, 0, 0]){
    Entity.call(this, X, Y, W, H);
    this.color = color; //list format
}
Bullet.prototype = Object.create(Entity.prototype);
Bullet.prototype.setVelocity = function(xVel, yVel){ this.velocity = {x: xVel, y: yVel}; }
Bullet.prototype.setUser = function(usr){ this.user = usr; }
Bullet.prototype.update = function(){
    this.move();
    this.draw();
    if(!this.onScreen()){
        this.dead = true;
    }
}
Bullet.prototype.draw = function(){
    var CTX = GAME.context;
    this.centerPosition();
    CTX.fillStyle = listToColor(this.color);
    CTX.fillRect(0, 0, this.width, this.height);
    CTX.restore();
}
Bullet.prototype.typeCheck = function(obj){
    if(obj instanceof Player || obj instanceof Enemy){
        var userP = (this.user) instanceof Player;
        var userE = (this.user) instanceof Enemy;
        var objP = obj instanceof Player;
        var objE = obj instanceof Enemy;
        if((userP && objE || userE && objP || this.user === null) && 
        this.collides(obj) && obj.invinciTimer <= 0){
            obj.whenHit();
            return true;
        }
    }
    return false;
}
Bullet.prototype.interact = function(obj){
    if(this.typeCheck(obj)){
        obj.hp--;
        if(obj instanceof Player){
            obj.invinciTimer = 75;
            sounds.hurt.currentTime = 0;
            sounds.hurt.play();
        }else{
            sounds.hit.currentTime = 0;
            sounds.hit.play();
        }
        this.dead = true;
        var particles = [];
        for(var i = 0; i < 12; i++){
            particles.push(new Particle(
                this.position.x + this.width/2,
                this.position.y + this.height/2,
                8, 2, [100, 0, 0], 20));
            particles[i].setVelocity(Math.random() * 20 - 10,
                                    Math.random() * 20 - 10);
            entities.push(particles[i]);
        }
    }
}

function LeftistBullet(X, Y){
    Bullet.call(this, X, Y, 8, 8);
    this.color = [100, 0, 0];
}
LeftistBullet.prototype = Object.create(Bullet.prototype);
LeftistBullet.prototype.update = function(){
    this.applyForce(-0.25, 0);
    Bullet.prototype.update.call(this);
}

function PowerBullet(X, Y){
    Bullet.call(this, X, Y, 50, 8);
    this.color = [0, 255, 0];
}
PowerBullet.prototype = Object.create(Bullet.prototype);
PowerBullet.prototype.interact = function(obj){
    if(this.typeCheck(obj)){
        obj.hp -= 5;
        this.dead = true;
		sounds.boom.currentTime = 0;
        sounds.boom.play();
        var particles = [];
        for(var i = 0; i < 16; i++){
            particles.push(new Particle(
                this.position.x + this.width/2,
                this.position.y + this.height/2,
                20, 10, [100, 0, 100], 20));
            particles[i].setVelocity(Math.random() * 30 - 15,
                                    Math.random() * 30 - 15);
            entities.push(particles[i]);
        }
    }
}

function Firework(X, Y){
    Bullet.call(this, X, Y, 20, 20);
    this.color = [0, 0, 0];
    this.delayTimer = 30;
}
Firework.prototype = Object.create(Bullet.prototype);
Firework.prototype.update = function(){
    Bullet.prototype.update.call(this);
    if(this.delayTimer <= 0){
        for(var i = 0; i < 2 * Math.PI; i += Math.PI/6){
            var b = new Bullet(this.position.x + this.width/2,
                                this.position.y + this.height/2, 8, 8,
                                [0, 0, 255]);
            b.setUser(this.user);
            b.setVelocity(12 * Math.cos(i), 12 * Math.sin(i));
            entities.push(b);
        }
        this.dead = true;
        sounds.boom.currentTime = 0;
        sounds.boom.play();
    }
    this.delayTimer--;
}
Firework.prototype.interact = function(obj){
    if(this.typeCheck(obj)){
        sounds.hit.currentTime = 0;
        sounds.hit.play();
        obj.hp -= 0.5;
        this.dead = true;
    }
}

function Shield(X, Y){
    Bullet.call(this, X, Y, 80, 80);
    this.color = [0, 100, 255];
    this.delayTimer = 30;
}
Shield.prototype = Object.create(Bullet.prototype);
Shield.prototype.draw = function(obj){
    var CTX = GAME.context;
    this.centerPosition();
    CTX.globalAlpha = 0.5;
    CTX.fillStyle = listToColor(this.color);
    CTX.fillRect(0, 0, this.width, this.height);
    CTX.globalAlpha = 1;
    CTX.restore();
}
Shield.prototype.update = function(){
    Bullet.prototype.update.call(this);
    if(this.delayTimer <= 0){
        this.dead = true;
    }
    this.delayTimer--;
}
Shield.prototype.fix = function(obj){
    if(obj instanceof Player && (this.user) instanceof Player){
        this.position.x = obj.position.x + obj.width/2 - this.width/2;
        this.position.y = obj.position.y + obj.height/2 - this.height/2;
    }
}
Shield.prototype.interact = function(obj){
    if(obj instanceof Bullet && this.collides(obj) &&
    obj.user != this.user){
        obj.dead = true;
        var particles = [];
        for(var i = 0; i < 10; i++){
            particles.push(new Particle(
                obj.position.x + obj.width/2,
                obj.position.y + obj.height/2,
                8, 2, [100, 0, 0], 20));
            particles[i].setVelocity(Math.random() * 10 - 5,
                                    Math.random() * 10 - 5);
            entities.push(particles[i]);
        }
        sounds.hit.currentTime = 0;
        sounds.hit.play();
    }
    this.fix(obj);
}

function Reflector(X, Y, W, H){
    Shield.call(this, X, Y);
    this.width = 20;
    this.height = 60;
    this.color = [150, 0, 100];
}
Reflector.prototype = Object.create(Shield.prototype);
Reflector.prototype.fix = function(obj){
    if(obj instanceof Player && (this.user) instanceof Player){
        this.position.x = obj.position.x + obj.width + 10;
        this.position.y = obj.position.y + obj.height/2 - this.height/2;
    }
}
Reflector.prototype.interact = function(obj){
    if(
        (obj instanceof Bullet || obj instanceof Enemy)
        && this.collides(obj) && obj.user != this.user){
        obj.velocity.x *= -1.25;
        if(obj instanceof Bullet){
            obj.setUser(this.user);
        }
        sounds.shieldBlock.currentTime = 0;
        sounds.shieldBlock.play();
    }
    this.fix(obj);
}

function WindScreen(){
    Shield.call(this, 0, 0);
    this.width = GAME.canvas.width;
    this.height = 200;
    this.delayTimer = 30;
    this.color = [200, 200, 200];
}
WindScreen.prototype = Object.create(Shield.prototype);
WindScreen.prototype.update = function(){
    this.draw();
    if(this.delayTimer <= 0){
        this.dead = true;
    }
    this.delayTimer--;
}
WindScreen.prototype.fix = function(obj){
    if(obj instanceof Player && (this.user) instanceof Player){
        this.position.x = 0;
        this.position.y = obj.position.y + obj.height/2 - this.height/2;
    }
}
WindScreen.prototype.interact = function(obj){
    if((obj instanceof Bullet || obj instanceof Enemy) && this.collides(obj)){
        obj.applyForce(1.5, 0);
        if(obj instanceof Bullet){
            obj.setUser(null);
        }
    }
    this.fix(obj);
}

function StabRod(X, Y){
    Shield.call(this, X, Y);
    this.width = 50;
    this.height = 10;
    this.delayTimer = 10;
    this.color = [255, 0, 0];
}
StabRod.prototype = Object.create(Shield.prototype);
StabRod.prototype.fix = function(obj){
    if(obj instanceof Player && (this.user) instanceof Player){
        this.position.x = obj.position.x + obj.width;
        this.position.y = obj.position.y + obj.height/2 - this.height/2;
    }
}
StabRod.prototype.interact = function(obj){
    if(
        (obj instanceof Enemy)
        && this.collides(obj) && obj.user != this.user){
        obj.hp -= 5;
        this.dead = true;
        sounds.hit.currentTime = 0;
        sounds.hit.play();
    }
    this.fix(obj);
}

function ForceShot(X, Y){
    Bullet.call(this, X, Y, 15, 50);
    this.color = [255, 200, 0];
}
ForceShot.prototype = Object.create(Bullet.prototype);
ForceShot.prototype.interact = function(obj){
    if(this.typeCheck(obj)){
        obj.hp -= 2;
        sounds.hit.currentTime = 0;
        sounds.hit.play();
        if(!obj.isBoss){
            obj.velocity.x = 22;
        }

        this.dead = true;
    }
}

function Enemy(X, Y, W, H){
    Entity.call(this, X, Y, W, H);
    this.color = [0, 0, 0];
    this.hp = 1;
    this.velocity = {x: -1, y: 0};
}
Enemy.prototype = Object.create(Entity.prototype);
Enemy.prototype.update = function(){
    this.move();
    this.draw();
    if(this.position.x + this.width < -100 ||
    this.position.x > GAME.canvas.width + 100 ||
    this.hp <= 0){
        this.dead = true;
    }
}
Enemy.prototype.draw = function(){
    var CTX = GAME.context;
    this.centerPosition();
    CTX.fillStyle = listToColor(this.color);
    CTX.fillRect(0, 0, this.width, this.height);
    CTX.restore();
}
Enemy.prototype.interact = function(obj){
    if(obj instanceof Player){
        if(this.collides(obj) && obj.invinciTimer <= 0){
            obj.hp--;
            obj.invinciTimer = 75;
			sounds.hurt.currentTime = 0;
			sounds.hurt.play();
        }
    }
}

function Bat(X, Y, variant=1){
    Enemy.call(this, X, Y, 30, 30);
    this.color = [0, 0, 0];
    this.hp = 1;
    this.velocity = {x: -8, y: 0};
    this.variant = variant;
}
Bat.prototype = Object.create(Enemy.prototype);
Bat.prototype.interact = function(obj){
    if(obj instanceof Player){
        if(this.variant > 1){
            if(Math.abs(this.position.y - obj.position.y) < 100){
                this.applyForce(0, -Math.sign(this.position.y - obj.position.y));
            }
            if(this.position.y < 0 || this.position.y > GAME.canvas.height){
                this.velocity.y *= -1;
            }
            if(this.variant > 2){
                if(this.position.x < obj.position.x){
                    this.applyForce(0.5, 0);
                }else{
                    this.applyForce(-0.1, 0);
                }
            }
        }
    }
    Enemy.prototype.interact.call(this, obj);
}

function Lost(X, Y, variant=1){
    Enemy.call(this, X, Y, 40, 40);
    this.color = [0, 0, 0];
    this.hp = 3;
    this.velocity = {x: 0, y: 0};
    this.variant = variant;
    this.delayTimer = 0;
    if(this.variant > 1){
        this.hp = 5;
    }
}
Lost.prototype = Object.create(Enemy.prototype);
Lost.prototype.update = function(){
    this.applyFriction();
    this.delayTimer++;
    Enemy.prototype.update.call(this);
}
Lost.prototype.interact = function(obj){
    if(obj instanceof Player){
        var dx = obj.position.x - this.position.x;
        var dy = obj.position.y - this.position.y;
        var mag = Math.sqrt(dx ** 2 + dy ** 2);
        this.applyForce(0.25 * dx/mag, 0.25 * dy/mag);
        if(this.delayTimer >= 125){
            this.delayTimer = 0;
            var b = new Bullet(this.position.x + this.width/2,
                                this.position.y + this.height/2, 10, 10);
            b.setUser(this);
            b.setVelocity(6 * dx/mag, 6 * dy/mag);
            entities.push(b);
            sounds.mehPew.currentTime = 0;
            sounds.mehPew.play();
        }
        if(mag < 200 && mag > 175 && this.variant > 2){
            this.applyForce(15 * dx/mag, 15 * dy/mag);
            sounds.rush.currentTime = 0;
            sounds.rush.play();
        }
    }
    Enemy.prototype.interact.call(this, obj);
}

function Raven(X, Y, variant=1){
    Enemy.call(this, X, Y, 40, 40);
    this.color = [0, 0, 100];
    this.hp = 7;
    this.velocity = {x: 0, y: 0};
    this.variant = variant;
    this.delayTimer = 0;
    this.retreating = true;
}
Raven.prototype = Object.create(Enemy.prototype);
Raven.prototype.update = function(){
    this.applyFriction();
    if(this.position.y < 0){
        this.position.y = 0;
        this.velocity.y *= -1;
    }
    if(this.position.y + this.height > GAME.canvas.height){
        this.position.y = GAME.canvas.height - this.height;
        this.velocity.y *= -1;
    }
    this.delayTimer++;
    Enemy.prototype.update.call(this);
}
Raven.prototype.interact = function(obj){
    if(obj instanceof Player){
        if(!this.retreating){
            var dx = obj.position.x - this.position.x;
            var dy = obj.position.y - this.position.y;
            var mag = Math.sqrt(dx ** 2 + dy ** 2);
            this.applyForce(2 * dx/mag, 0.5 * dy/mag);
            if(this.position.x < player.position.x || this.delayTimer > 250){
                this.retreating = true;
                this.delayTimer = 0;
            }
        }else{
            var dx = GAME.canvas.width * 0.9 - this.position.x;
            var dy = obj.position.y - this.position.y;
            var mag = Math.sqrt(dx ** 2 + dy ** 2);
            if(this.delayTimer < 150){
                this.applyForce(1 * dx/mag, 3 * Math.cos(this.delayTimer/50 * 2 * Math.PI));
            }
            this.applyForce(0, 0.5 * dy/mag);
            if(this.delayTimer > 175 && 
            Math.abs(this.position.y - player.position.y) < this.height){
                this.retreating = false;
            }
        }
    }
    Enemy.prototype.interact.call(this, obj);
}
Raven.prototype.whenHit = function(){
    if(this.variant < 2){
        this.retreating = true;
        this.delayTimer = 0;
    }else if(this.variant > 2){
        for(var i = 0; i < 2 * Math.PI; i += Math.PI/3){
            var b = new LeftistBullet(this.position.x + this.width/2,
                                this.position.y + this.height/2, 8, 8);
            b.setUser(this);
            b.setVelocity(2 * Math.cos(i), 2 * Math.sin(i));
            entities.push(b);
        }
    }
}

function CrossShot(X, Y, variant=1){
    Enemy.call(this, X, Y, 40, 40);
    this.color = [255, 128, 0];
    this.hp = 3;
    this.velocity = {x: 0, y: 0};
    this.variant = variant;
    this.delayTimer = 0;
    if(this.variant > 1){
        this.hp = 5;
    }
}
CrossShot.prototype = Object.create(Enemy.prototype);
CrossShot.prototype.update = function(){
    this.applyFriction();
    this.delayTimer++;
    if(this.delayTimer % 10 == 0 && this.delayTimer > 100){
        var b = new Bullet(this.position.x + this.width/2,
                        this.position.y + this.height/2, 10, 10);
        b.setUser(this);
        b.setVelocity(-8, 0);
        entities.push(b);
        sounds.pew.currentTime = 0;
        sounds.pew.play();
        if(this.delayTimer == 150 || this.variant == 3){
            for(var i = 3 * Math.PI/4; i < 11 * Math.PI/8; i += Math.PI/8){
                var b = new Bullet(this.position.x + this.width/2,
                                this.position.y + this.height/2, 10, 10);
                b.setUser(this);
                b.setVelocity(8 * Math.cos(i), 8 * -Math.sin(i));
                entities.push(b);
                sounds.pew.currentTime = 0;
                sounds.pew.play();
            }
        }
    }
    if(this.delayTimer > 150){
        this.delayTimer = 0;
    }
    Enemy.prototype.update.call(this);
}
CrossShot.prototype.interact = function(obj){
    if(obj instanceof Player){
        if(this.delayTimer < 50){
            this.applyForce(-0.3, 1 * Math.sin(this.delayTimer/25 * 2 * Math.PI));
        }
    }
    Enemy.prototype.interact.call(this, obj);
}

function Mirage(X, Y, variant=1){
    Enemy.call(this, X, Y, 30, 30);
    this.color = [255, 0, 255];
    this.hp = 1;
    this.velocity = {x: 0, y: 0};
    this.variant = variant;
    this.delayTimer = 0;
}
Mirage.prototype = Object.create(Enemy.prototype);
Mirage.prototype.draw = function(){
    var CTX = GAME.context;
    this.centerPosition();
    CTX.globalAlpha = (20 - this.delayTimer % 20)/20;
    CTX.fillStyle = listToColor(this.color);
    CTX.fillRect(0, 0, this.width, this.height);
    CTX.restore();
    CTX.globalAlpha = 1;
}
Mirage.prototype.update = function(){
    this.delayTimer++;
    if(this.delayTimer % 20 == 0 && this.delayTimer < 100){
        this.position.x -= 200 * Math.random() + 50;
        this.position.y += 400 * Math.random() - 200 - 
                            (this.position.y - GAME.canvas.height/2);
        if(this.variant > 2){
            for(var i = 0; i < 2 * Math.PI; i += 2 * Math.PI/5){
                var b = new Bullet(this.position.x + this.width/2,
                                this.position.y + this.height/2, 10, 10);
                b.setUser(this);
                b.setVelocity(8 * Math.cos(i), 8 * -Math.sin(i));
                entities.push(b);
                sounds.pew.currentTime = 0;
                sounds.pew.play();
            }
        }
    }else if(this.delayTimer > 120){
        this.delayTimer = 0;
    }
    Enemy.prototype.update.call(this);
}
Mirage.prototype.interact = function(obj){
    if(obj instanceof Player){
        if(this.delayTimer > 100 && this.delayTimer % 5 == 0){
            var dx = obj.position.x - this.position.x;
            var dy = obj.position.y - this.position.y;
            if(this.variant > 1){
                dy = 0;
            }
            var mag = Math.sqrt(dx ** 2 + dy ** 2);
            var b = new Bullet(this.position.x + this.width/2,
                                this.position.y + this.height/2, 10, 10);
            b.setUser(this);
            b.setVelocity(8 * dx/mag, 8 * dy/mag);
            entities.push(b);
            sounds.pew.currentTime = 0;
            sounds.pew.play();
        }
    }
    Enemy.prototype.interact.call(this, obj);
}

function DemonShape(X, Y, variant=1){
    Enemy.call(this, X, Y, 65, 65);
    this.hp = 25;
    if(this.variant > 1){
        this.hp = 35;
    }
    this.color = [75, 50, 75];
    this.variant = variant;
    this.delayTimer = 0;
}
DemonShape.prototype = Object.create(Enemy.prototype);
DemonShape.prototype.update = function(){
    this.applyFriction();
    this.applyFriction();
    this.applyFriction();
    //He doesn't like to be moved
    this.applyForce(-0.542, 0);
    this.delayTimer++;
    if(this.delayTimer > 125 && this.delayTimer % 5 == 0){
        for(var i = 0; i < 2*Math.PI + 0.0001; i += Math.PI/2){
            var b = new Bullet(
                this.position.x + this.width/2 - 7.5 + 41 * Math.cos(i),
                this.position.y + this.height/2 - 7.5 - 41 * Math.sin(i),
                15, 15);
            b.setUser(this);
            if(this.variant == 1){
                b.setVelocity(-2 + 9 * Math.cos(i),
                9 * -Math.sin(i));
            }else{
                b.setVelocity(-2 + 11 * Math.cos(i),
                11 * -Math.sin(i));
            }
            entities.push(b);
            sounds.pew.currentTime = 0;
            sounds.pew.play();
        }
    }
    if(this.variant > 2 && this.delayTimer > 100 &&
    this.delayTimer < 125 && this.delayTimer % 5 == 0){
        for(var i = Math.PI/4; i < 9*Math.PI/4 + 0.0001;
        i += Math.PI/2){
            var b = new Bullet(
                this.position.x + this.width/2 - 7.5 + 43 * Math.cos(i),
                this.position.y + this.height/2 - 7.5 - 43 * Math.sin(i),
                15, 15);
            b.setUser(this);
            if(this.variant == 1){
                b.setVelocity(-2 + 9 * Math.cos(i),
                9 * -Math.sin(i));
            }else{
                b.setVelocity(-2 + 11 * Math.cos(i),
                11 * -Math.sin(i));
            }
            entities.push(b);
            sounds.pew.currentTime = 0;
            sounds.pew.play();
        }
    }
    if(this.delayTimer > 150){
        this.delayTimer = 0;
    }
    Enemy.prototype.update.call(this);
}

function Memory(X, Y, variant=1){
    Enemy.call(this, X, Y, 40, 40);
    this.hp = 99999;
    this.dying = false;
    this.color = [200, 200, 200];
    this.variant = variant;
    this.delayTimer = 0;
}
Memory.prototype = Object.create(Enemy.prototype);
Memory.prototype.update = function(){
    this.applyFriction();
    this.applyForce(-0.2, 0);
    if(this.delayTimer <= 100 && this.dying){
        this.delayTimer++;
        if(this.delayTimer % 3 == 0){
            for(var i = 0; i < 4; i++){
                var b = new Bullet(this.position.x + this.width/2,
                                    this.position.y + this.height/2, 10, 10);
                b.setUser(this);
                b.setVelocity(-2 + 6 * Math.cos(i * Math.PI/2 + this.delayTimer/100 * 2 * Math.PI),
                            6 * Math.sin(i * Math.PI/2 + this.delayTimer/100 * 2 * Math.PI));
                entities.push(b);
                sounds.pew.currentTime = 0;
                sounds.pew.play();
            }
        }
    }
    if(this.delayTimer > 100){
        this.dead = true;
        sounds.bossDeath.currentTime = 0;
        sounds.bossDeath.play();
    }
    Enemy.prototype.update.call(this);
}
Memory.prototype.interact = function(obj){
    if(obj instanceof Player && this.collides(obj)){
        this.dead = true;
    }
}
Memory.prototype.whenHit = function(){
    //activate nuke
    this.dying = true;
    this.color = [100, 0, 0];
}

function WhiteHead(X, Y, variant=1){
    Enemy.call(this, X, Y, 25, 25);
    this.color = [255, 255, 255];
    this.hp = 4;
    this.velocity = {x: 0, y: 0};
    this.variant = variant;
    this.delayTimer = 0;
    this.aimPos = {DX: 0, DY: 0, MAG: 1};
}
WhiteHead.prototype = Object.create(Enemy.prototype);
WhiteHead.prototype.draw = function(){
    var CTX = GAME.context;
    this.centerPosition();
    CTX.fillStyle = "#000000";
    CTX.fillRect(-1, -1, this.width + 2, this.height + 2);
    CTX.fillStyle = listToColor(this.color);
    CTX.fillRect(0, 0, this.width, this.height);
    CTX.restore();
    CTX.globalAlpha = 1;
}
WhiteHead.prototype.update = function(){
    this.applyFriction();
    this.delayTimer++;
    Enemy.prototype.update.call(this);
}
WhiteHead.prototype.interact = function(obj){
    if(obj instanceof Player){
        var dx = obj.position.x - this.position.x;
        var dy = obj.position.y - this.position.y;
        var mag = Math.sqrt(dx ** 2 + dy ** 2);
        this.applyForce(0.15 * dx/mag, 0.15 * dy/mag);
        if(this.delayTimer == 100){
            this.aimPos = {DX: dx, DY: dy, MAG: mag};
        }
        if(this.delayTimer >= 100 && this.delayTimer % 4 == 0){
            var b = new Bullet(this.position.x + this.width/2,
                                this.position.y + this.height/2, 10, 10,
                                [255, 0, 0]);
            b.setUser(this);
            b.setVelocity(3 * this.aimPos.DX/this.aimPos.MAG,
                        3 * this.aimPos.DY/this.aimPos.MAG);
            entities.push(b);
        }
        if(this.delayTimer >= 125){
            this.delayTimer = 0;
        }
    }
    Enemy.prototype.interact.call(this, obj);
}

function BlackHead(X, Y, variant=1){
    Enemy.call(this, X, Y, 25, 25);
    this.color = [0, 0, 0];
    this.hp = 1;
    this.velocity = {x: 0, y: 0};
    this.variant = variant;
    this.delayTimer = 0;
    this.aimPos = {DX: 0, DY: 0, MAG: 1};
}
BlackHead.prototype = Object.create(Enemy.prototype);
BlackHead.prototype.update = function(){
    this.applyFriction();
    if(this.position.y < 0){
        this.position.y = 0;
        this.velocity.y *= -1;
    }
    if(this.position.y + this.height > GAME.canvas.height){
        this.position.y = GAME.canvas.height - this.height;
        this.velocity.y *= -1;
    }
    this.delayTimer++;
    Enemy.prototype.update.call(this);
}
BlackHead.prototype.interact = function(obj){
    if(obj instanceof Player){
        var dx = obj.position.x - this.position.x;
        var dy = obj.position.y - this.position.y;
        var mag = Math.sqrt(dx ** 2 + dy ** 2);
        if(this.delayTimer < 75){
            this.applyForce(0.8 * dx/mag, 0.8 * dy/mag);
        }else{
            this.applyForce(-0.3 * dx/mag, -0.3 * dy/mag);
        }
        this.applyForce(0.7 * Math.cos(GAME.frameCount/60),
        0.7 * -Math.sin(GAME.frameCount/60));
        if(this.delayTimer % 75 == 0){
            var b = new Bullet(this.position.x + this.width/2,
                                this.position.y + this.height/2, 10, 10,
                                [255, 0, 0]);
            b.setUser(this);
            b.setVelocity(7 * dx/mag, 7 * dy/mag);
            entities.push(b);
            sounds.pew.currentTime = 0;
            sounds.pew.play();
        }
        if(this.delayTimer >= 100){
            this.delayTimer = 0;
        }
    }
    Enemy.prototype.interact.call(this, obj);
}

function DoomFairy(X, Y, variant=1){
    Enemy.call(this, X, Y, 80, 80);
    this.color = [255, 0, 0];
    this.hp = 100;
    this.variant = variant;
    if(this.variant > 1){
        this.hp = 125;
    }
    this.delayTimer = 0;
    this.isBoss = true;
}
DoomFairy.prototype = Object.create(Enemy.prototype);
DoomFairy.prototype.update = function(){
    if(this.position.x < 0){
        this.position.x = 0;
        this.velocity.x *= -1;
    }
    if(this.position.x + this.width > GAME.canvas.width){
        this.position.x = GAME.canvas.width - this.width;
        this.velocity.x *= -1;
    }
    if(this.position.y < 0){
        this.position.y = 0;
        this.velocity.y *= -1;
    }
    if(this.position.y + this.height > GAME.canvas.height){
        this.position.y = GAME.canvas.height - this.height;
        this.velocity.y *= -1;
    }
    this.applyFriction();
    if(this.variant <= 0){
        this.applyFriction();
    }
    if(this.variant < 2){
        this.velocity.x *= 1.1;
        this.velocity.y *= 1.1;
    }else{
        this.velocity.x *= 1.11;
        this.velocity.y *= 1.11;
    }
    this.delayTimer++;
    if(this.delayTimer < 100 && this.delayTimer % 2 == 0 &&
        (this.variant != 0 || this.delayTimer % 4 == 0)){
        for(var i = 0; i < 2; i++){
            var b = new Bullet(this.position.x + this.width/2,
                                this.position.y + this.height/2, 10, 10);
            b.setUser(this);
            b.setVelocity(6 * (i * 2 - 1) * Math.cos(this.delayTimer/50 * 2 * Math.PI),
                        6 * (i * 2 - 1) * Math.sin(this.delayTimer/50 * 2 * Math.PI));
            entities.push(b);
            sounds.pew.currentTime = 0;
            sounds.pew.play();
        }
    }
    if(this.delayTimer > 240 && this.delayTimer < 245 && this.variant > 2){
        this.velocity.x = 0;
        this.velocity.y = 0;
    }
    if(this.delayTimer > 300){
        this.delayTimer = 0;
    }
    Enemy.prototype.update.call(this);
    if(this.dead){
        GAME.level++;
        GAME.frameCount = 0;
        player.hp = 3;
        musics[GAME.level - 2].pause();
        musics[GAME.level - 1].play();
        sounds.bossDeath.play();
    }
}
DoomFairy.prototype.interact = function(obj){
    if(obj instanceof Player){
        if(this.delayTimer < 250 && this.delayTimer > 245){
            var dx = obj.position.x - this.position.x;
            var dy = obj.position.y - this.position.y;
            var mag = Math.sqrt(dx ** 2 + dy ** 2);
            if(this.variant < 2){
                this.applyForce(5 * dx/mag, 5 * dy/mag);
            }else{
                this.applyForce(7 * dx/mag, 7 * dy/mag);
            }
            sounds.rush.currentTime = 0;
            sounds.rush.play();
        }
    }
    Enemy.prototype.interact.call(this, obj);
}

function Blazer(X, Y, variant=1){
    Enemy.call(this, X, Y, 80, 80);
    this.color = [0, 255, 0];
    this.hp = 100;
    this.variant = variant;
    if(this.variant > 1){
        this.hp = 125;
    }
    this.delayTimer = 0;
    this.movingLeft = true;
    this.isBoss = true;
    this.sprayDuration = 150;
}
Blazer.prototype = Object.create(Enemy.prototype);
Blazer.prototype.update = function(){
    var windActive = false;
    for(var i in entities){
        if(entities[i] instanceof WindScreen){
            windActive = true;
            break;
        }
    }
    this.delayTimer++;
    this.applyFriction();
    if(this.delayTimer % 20 == 0 && (this.variant > 2 || this.delayTimer % 80 == 0)){
        var b = new Bullet(this.position.x + this.width/2 - 30,
                            this.position.y + this.height/2 - 5,
                            40, 10, [255, 0, 0]);
        b.setUser(this);
        b.setVelocity(-10, 0);
        entities.push(b);
        var b = new Bullet(this.position.x + this.width/2 - 30,
                        this.position.y + this.height/2 - 5,
                        40, 10, [255, 0, 0]);
        b.setUser(this);
        b.setVelocity(10, 0);
        entities.push(b);
        sounds.laserPew.currentTime = 0;
        sounds.laserPew.play();
    }
    if(this.delayTimer > 125 &&
    this.delayTimer < 125 + this.sprayDuration &&
    ((this.delayTimer % 2 == 0 && this.variant > 2) ||
    (this.delayTimer % 3 == 0)) && !windActive){
        var angle = Math.PI/2 + 1.5 * Math.cos(
            (this.delayTimer - 75)/(this.sprayDuration/2)
            * Math.PI * 2);
        var b = new Bullet(this.position.x + this.width/2,
                            this.position.y + this.height/2, 10, 10);
        b.setUser(this);
        b.setVelocity(6 * Math.cos(angle),
                    6 * Math.sin(angle));
        entities.push(b);
        var b = new Bullet(this.position.x + this.width/2,
                            this.position.y + this.height/2, 10, 10);
        b.setUser(this);
        b.setVelocity(6 * Math.cos(angle + Math.PI),
                    6 * Math.sin(angle + Math.PI));
        entities.push(b);
        sounds.pew.currentTime = 0;
        sounds.pew.play();
    }
    if(this.delayTimer > 125 + this.sprayDuration){
        this.delayTimer = 0;
    }
    Enemy.prototype.update.call(this);
}
Blazer.prototype.interact = function(obj){
    if(obj instanceof Player){
        if(this.delayTimer < 75){
            this.applyForce(
                0.75 * Math.sign(obj.position.x - this.position.x), 0);
            sounds.uwu.play();
        }
    }
    Enemy.prototype.interact.call(this, obj);
}

function Wall(X, Y, W, H, variant=1){
    Entity.call(this, X, Y, W, H);
    this.variant = variant;
    this.color = [0, 0, 0];
    this.hp = 999;
    this.velocity = {x: -2, y: 0};
}
Wall.prototype = Object.create(Entity.prototype);
Wall.prototype.update = function(){
    Enemy.prototype.update.call(this);
}
Wall.prototype.draw = function(){
    Enemy.prototype.draw.call(this);
}
Wall.prototype.interact = function(obj){
    if((obj instanceof Player || obj instanceof Enemy ||
    (obj instanceof Bullet && !(obj instanceof Shield)
    && this.variant > 1)) && 
    this.collides(obj) && !(obj instanceof Wall)){
        //Left
        if(obj.position.x + obj.width > this.position.x &&
        obj.position.x + obj.width < this.position.x + 20){
            obj.position.x = this.position.x - obj.width;
            obj.velocity.x *= -1;
            if(this.position.x < obj.width){
                obj.hp -= 999;
            }
        }
        //Right
        if(obj.position.x < this.position.x + this.width &&
        obj.position.x > this.position.x + this.width - 20){
            obj.position.x = this.position.x + this.width;
            obj.velocity.x *= -1;
        }
        //Up
        if(obj.position.y + obj.height > this.position.y &&
        obj.position.y + obj.height < this.position.y + 20){
            obj.position.y = this.position.y - obj.height;
            obj.velocity.y *= -1;
        }
        //Down
        if(obj.position.y < this.position.y + this.height &&
        obj.position.y > this.position.y + this.height - 20){
            obj.position.y = this.position.y + this.height;
            obj.velocity.y *= -1;
        }
    }
    if(obj instanceof Bullet && !(obj instanceof Shield)
    && this.collides(obj)){
        if(this.variant == 1){
            obj.dead = true;
        }
    }
}

function Player(X, Y, W, H){
    Entity.call(this, X, Y, W, H);
    this.goingLeft = false;
    this.goingRight = false;
    this.goingUp = false;
    this.goingDown = false;
    this.delayTimer = 0;
    this.hp = 3;
    this.invinciTimer = 0;
}
Player.prototype = Object.create(Entity.prototype);
Player.prototype.update = function(){
    if(this.goingLeft){
        this.applyForce(-0.75, 0);
    }
    if(this.goingRight){
        this.applyForce(0.75, 0);
    }
    if(this.goingUp){
        this.applyForce(0, -0.75);
    }
    if(this.goingDown){
        this.applyForce(0, 0.75);
    }
    if(this.delayTimer < 100){
        this.delayTimer++;
    }
    if(this.invinciTimer > 0){
        this.invinciTimer--;
    }
    if(this.position.x < 0){
        this.position.x = 0;
        this.velocity.x *= -1;
    }
    if(this.position.x + this.width > GAME.canvas.width){
        this.position.x = GAME.canvas.width - this.width;
        this.velocity.x *= -1;
    }
    if(this.position.y < 0){
        this.position.y = 0;
        this.velocity.y *= -1;
    }
    if(this.position.y + this.height > GAME.canvas.height){
        this.position.y = GAME.canvas.height - this.height;
        this.velocity.y *= -1;
    }
    //GAME.camera.x = this.position.x - GAME.canvas.width/2 + this.width/2;
    //GAME.camera.y = this.position.y - GAME.canvas.height/2 + this.height/2;
    //console.log(player.velocity.y);
    this.move();
    this.applyFriction();
    this.draw();
}
Player.prototype.draw = function(){
    var CTX = GAME.context;
    var color = [255, 0, 0];
    if(this.invinciTimer > 0){
        color = [255, this.invinciTimer % 2 * 255, this.invinciTimer % 2 * 255];
    }
    CTX.fillStyle = listToColor(color);
    CTX.fillRect(0, 0, this.width, this.height);
    CTX.restore();
}
function drawForeground(){
    var CTX = GAME.context;
    CTX.fillStyle = "#FF0000";
    CTX.fillRect(15, 15, player.delayTimer * 2, 15);
    for(var i = 0; i < player.hp; i++){
        CTX.fillRect(15 + 20 * i, 50, 15, 15);
    }
    if(player.hp <= 0){
        clearInterval(GAME.interval);
        alert("GAME OVER!\nReload the page to try again.");
        for(var i = 0; i < musics.length; i++){
            musics[i].pause();
        }
    }
}

function PWeapon(name, charge){
    this.name = name;
    this.charge = charge;
}
PWeapon.prototype.fire = function(){
    if(player.delayTimer >= this.charge){
        this.pewpew();
        player.delayTimer -= this.charge;
    }
}
PWeapon.prototype.pewpew = function(){
    //stub method
}

function W_Peashooter(){
    PWeapon.call(this, "Peashooter", 10);
}
W_Peashooter.prototype = Object.create(PWeapon.prototype);
W_Peashooter.prototype.pewpew = function(){
    var b = new Bullet(player.position.x + player.width/2,
                            player.position.y + player.height/2, 8, 8,
                            [0, 0, 255]);
    b.setUser(player);
    b.setVelocity(12, 0);
    entities.push(b);
    sounds.pew.currentTime = 0;
    sounds.pew.play();
}

function W_TripleShot(){
    PWeapon.call(this, "Triple Shot", 20);
}
W_TripleShot.prototype = Object.create(PWeapon.prototype);
W_TripleShot.prototype.pewpew = function(){
    var angle = 15 * Math.PI/180;
    for(var i = -angle; i <= angle; i += angle){
        var b = new Bullet(player.position.x + player.width/2,
                                player.position.y + player.height/2, 8, 8,
                                [0, 0, 255]);
        b.setUser(player);
        b.setVelocity(12 * Math.cos(i), -12 * Math.sin(i));
        entities.push(b);
    }
    sounds.pew.currentTime = 0;
    sounds.pew.play();
}

function W_Blaster(){
    PWeapon.call(this, "Power Blaster", 30);
}
W_Blaster.prototype = Object.create(PWeapon.prototype);
W_Blaster.prototype.pewpew = function(){
    var b = new PowerBullet(player.position.x + player.width/2,
                            player.position.y + player.height/2);
    b.setUser(player);
    b.setVelocity(15, 0);
    entities.push(b);
    sounds.laserPew.currentTime = 0;
    sounds.laserPew.play();
}

function W_FireworkLauncher(){
    PWeapon.call(this, "Firework", 25);
}
W_FireworkLauncher.prototype = Object.create(PWeapon.prototype);
W_FireworkLauncher.prototype.pewpew = function(){
    var b = new Firework(player.position.x + player.width/2,
                        player.position.y + player.height/2);
    b.setUser(player);
    b.setVelocity(12, 0);
    entities.push(b);
    sounds.pew.currentTime = 0;
    sounds.pew.play();
}

function W_Shield(){
    PWeapon.call(this, "Shield", 40);
}
W_Shield.prototype = Object.create(PWeapon.prototype);
W_Shield.prototype.pewpew = function(){
    var s = new Shield(player.position.x, player.position.y);
    s.setUser(player);
    player.invinciTimer = 30;
    entities.push(s);
	sounds.shieldStart.currentTime = 0;
	sounds.shieldStart.play();
}

function W_Reflector(){
    PWeapon.call(this, "Reflector", 40);
}
W_Reflector.prototype = Object.create(PWeapon.prototype);
W_Reflector.prototype.pewpew = function(){
    var r = new Reflector(player.position.x, player.position.y);
    r.setUser(player);
    player.invinciTimer = 25;
    entities.push(r);
	sounds.shieldStart.currentTime = 0;
	sounds.shieldStart.play();
}

function W_Wind(){
    PWeapon.call(this, "Divine Wind", 100);
}
W_Wind.prototype = Object.create(PWeapon.prototype);
W_Wind.prototype.pewpew = function(){
    var w = new WindScreen();
    w.setUser(player);
    entities.push(w);
    sounds.wind.currentTime = 0;
    sounds.wind.play();
}

function W_ForceShooter(){
    PWeapon.call(this, "Force Shooter", 20);
}
W_ForceShooter.prototype = Object.create(PWeapon.prototype);
W_ForceShooter.prototype.pewpew = function(){
    var b = new ForceShot(player.position.x + player.width/2,
                            player.position.y + player.height/2 - 25);
    b.setUser(player);
    b.setVelocity(20, 0);
    entities.push(b);
	sounds.weirdPew.currentTime = 0;
	sounds.weirdPew.play();
}

function W_StabRod(){
    PWeapon.call(this, "Stab Rod", 10);
}
W_StabRod.prototype = Object.create(PWeapon.prototype);
W_StabRod.prototype.pewpew = function(){
    var s = new StabRod(player.position.x, player.position.y);
    s.setUser(player);
    entities.push(s);
}

var entities = [];
var player = new Player(0, 0, 30, 30);
var initTime = 0;
var weapons = [
    new W_Peashooter(),
    new W_Blaster(),
    new W_FireworkLauncher(),
    new W_Shield(),
    new W_Reflector(),
    new W_Wind(),
    new W_ForceShooter(),
    new W_TripleShot(),
    new W_StabRod()
];
var rWeapons = weapons.slice();
rWeapons.sort( function() { return 0.5 - Math.random() } );

player.weapons = [rWeapons[5], rWeapons[1], rWeapons[3]];
document.onkeydown = function(e){
    if(e.keyCode == 80){ //P, pause
        if(GAME.isPaused){
            GAME.activate();
        }else{
            GAME.pause();
        }
        sounds.pause.currentTime = 0;
        sounds.pause.play();
    }
    if(player.hp > 0 && !GAME.isPaused){
        musics[GAME.level - 1].play();
        e = e || window.event;
        if(e.keyCode == 37){ //Left
            player.goingLeft = true;
        }
        if(e.keyCode == 39){ //Right
            player.goingRight = true;
        }
        if(e.keyCode == 38){ //Up
            player.goingUp = true;
        }
        if(e.keyCode == 40){ //Down
            player.goingDown = true;
        }
        if(e.keyCode == 16){ //Shift
            player.velocity.x *= -1;
            player.velocity.y *= -1;
        }
        if(e.keyCode == 90){ //Z, shoot primary weapon
            if(player.weapons[0] != null){
                player.weapons[0].fire();
            }
        }
        if(e.keyCode == 88){ //X, shoot secondary weapon
            if(player.weapons[1] != null){
                player.weapons[1].fire();
            }
        }
        if(e.keyCode == 67){ //C, shoot tertiary weapon
            if(player.weapons[2] != null){
                player.weapons[2].fire();
            }
        }
        if(e.keyCode == 79){ //O, skip level
            GAME.level++;
            GAME.frameCount = 0;
            player.hp = 3;
            musics[GAME.level - 2].pause();
            musics[GAME.level - 1].play();
            sounds.bossDeath.play();
        }
        if(e.keyCode == 81){ //Q, fast-forward
            GAME.frameCount = Number(prompt());
        }
    }
}
document.onkeyup = function(e){
    e = e || window.event;
    if(e.keyCode == 37){ //Left
        player.goingLeft = false;
    }
    if(e.keyCode == 39){ //Right
        player.goingRight = false;
    }
    if(e.keyCode == 38){ //Up
        player.goingUp = false;
    }
    if(e.keyCode == 40){ //Down
        player.goingDown = false;
    }
}
function init(){
    GAME.start();
    alert("Instructions:\n================\nArrow keys to move. Z/X/C to use weapons (randomly selected every game)\nP to Pause.");
    alert("Weapon Loadout:\nZ: " +  player.weapons[0].name +
        "\nX: " + player.weapons[1].name +
        "\nC: " + player.weapons[2].name);
    GAME.activate();
}
function spawnEntities(){
    if(GAME.difficulty == 0){
        if(GAME.level == 1){
            if(GAME.frameCount == 0){
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2,
                                "Stage 1 - Forest", 50, [0, 0, 0], 150));
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2 + 50,
                                "BGM: ♪ A Melancholy Autumn ♪", 20, [100, 100, 100], 150));
            }
            if(GAME.frameCount < 500){
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 1000){
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 2000){
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 2500){
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 500 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 3500){
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 750 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 4500){
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 650 == 200){
                    entities.push(new Raven(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 5500){
                if(GAME.frameCount % 600 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 7500){
                if(GAME.frameCount % 500 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 600 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 9000){
                if(GAME.frameCount % 500 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 50 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 2));
                }
                if(GAME.frameCount % 700 == 350){
                    entities.push(new Mirage(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 500 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 2));
                }
            }
            if(GAME.frameCount == 9000){
                entities.push(new DoomFairy(1199, 300, 0));
            }
        }else if(GAME.level == 2){
            if(GAME.frameCount == 0){
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2,
                                "Stage 2 — City", 50, [0, 0, 0], 150));
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2 + 50,
                                "BGM: ♪ Urban Groove ♪", 20, [100, 100, 100], 150));
            }
            if(GAME.frameCount % 400 == 0){
                entities.push(new Wall(1199, 0, 200, 200, 1));
                entities.push(new Wall(1199,
                GAME.canvas.height - 200, 200, 200, 1));
            }
            if(GAME.frameCount < 500){
                if(GAME.frameCount % 200 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 2));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 2));
                    }
                }
            }else if(GAME.frameCount < 1500){
                if(GAME.frameCount % 400 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 3));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 3));
                    }
                }
            }else if(GAME.frameCount < 2500){
                if(GAME.frameCount % 400 == 0){
                    entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 1));
                }
            }else if(GAME.frameCount < 5000){
                if(GAME.frameCount % 350 == 0){
                    if(GAME.frameCount % 250 >= 100){
                        entities.push(new DemonShape(1199, Math.random() * 550, 1));
                    }else{
                        entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 1));
                    }
                }
                if(GAME.frameCount % 250 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 2));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 2));
                    }
                }
            }else if(GAME.frameCount < 5250){
                if(GAME.frameCount % 250 == 0){
                    entities.push(new Memory(1199, 280, 1));
                }
            }else if(GAME.frameCount < 6500){
                if(GAME.frameCount % 350 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 2));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 2));
                    }
                }
                if(GAME.frameCount % 400 == 0){
                    entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 1));
                }
                if(GAME.frameCount % 500 == 0){
                    entities.push(new Memory(1199, 280, 1));
                }
            }else if(GAME.frameCount < 8000 && GAME.frameCount > 7000){
                if(GAME.frameCount % 800 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new WhiteHead(1199, Math.random() * 550, 1));
                        entities.push(new BlackHead(1199, Math.random() * 550, 1));
                    }else{
                        entities.push(new WhiteHead(1199, 200 + Math.random() * 150, 1));
                        entities.push(new BlackHead(1199, 200 + Math.random() * 150, 1));
                    }
                }
            }else if(GAME.frameCount < 10000){
                if(GAME.frameCount % 300 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 2));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 2));
                    }
                }
                if(GAME.frameCount % 700 == 0){
                    entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 1));
                }
                if(GAME.frameCount % 800 == 0){
                    entities.push(new Memory(1199, 280, 1));
                }
                if(GAME.frameCount % 1000 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new WhiteHead(1199, Math.random() * 550, 1));
                        entities.push(new BlackHead(1199, Math.random() * 550, 1));
                    }else{
                        entities.push(new WhiteHead(1199, 200 + Math.random() * 150, 1));
                        entities.push(new BlackHead(1199, 200 + Math.random() * 150, 1));
                    }
                }
            }
            if(GAME.frameCount == 10000){
                entities.push(new Blazer(1199, 260, 1));
            }
        }
    }else if(GAME.difficulty == 1){
        if(GAME.level == 1){
            if(GAME.frameCount == 0){
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2,
                                "Stage 1 — Forest (Hard)", 50, [0, 0, 0], 150));
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2 + 50,
                                "BGM: ♪ A Melancholy Autumn ♪", 20, [100, 100, 100], 150));
            }
            if(GAME.frameCount < 500){
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 1000){
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 2000){
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 2500){
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 3500){
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 750 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 4500){
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 650 == 200){
                    entities.push(new Raven(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 5500){
                if(GAME.frameCount % 600 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 1));
                }
            }else if(GAME.frameCount < 7500){
                if(GAME.frameCount % 500 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 2));
                }
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 2));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 2));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 2));
                }
            }else if(GAME.frameCount < 9000){
                if(GAME.frameCount % 500 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 2));
                }
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 700 == 350){
                    entities.push(new Mirage(1199, Math.random() * 550, 1));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 3));
                }
            }
            if(GAME.frameCount == 9000){
                entities.push(new DoomFairy(1199, 300, 1));
            }
        }else if(GAME.level == 2){
            if(GAME.frameCount == 0){
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2,
                                "Stage 2 — City (Hard)", 50, [0, 0, 0], 150));
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2 + 50,
                                "BGM: ♪ Urban Groove ♪", 20, [100, 100, 100], 150));
            }
            if(GAME.frameCount % 400 == 0){
                entities.push(new Wall(1199, 0, 200, 200, 1));
                entities.push(new Wall(1199,
                GAME.canvas.height - 200, 200, 200, 1));
            }
            if(GAME.frameCount < 500){
                if(GAME.frameCount % 100 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 2));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 2));
                    }
                }
            }else if(GAME.frameCount < 1500){
                if(GAME.frameCount % 200 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 3));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 3));
                    }
                }
            }else if(GAME.frameCount < 2500){
                if(GAME.frameCount % 250 == 0){
                    entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 1));
                }
            }else if(GAME.frameCount < 5000){
                if(GAME.frameCount % 350 == 0){
                    if(GAME.frameCount % 250 >= 100){
                        entities.push(new DemonShape(1199, Math.random() * 550, 1));
                    }else{
                        entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 1));
                    }
                }
                if(GAME.frameCount % 200 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 2));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 2));
                    }
                }
            }else if(GAME.frameCount < 5250){
                if(GAME.frameCount % 250 == 0){
                    entities.push(new Memory(1199, 280, 1));
                }
            }else if(GAME.frameCount < 6500){
                if(GAME.frameCount % 200 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 2));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 2));
                    }
                }
                if(GAME.frameCount % 400 == 0){
                    entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 1));
                }
                if(GAME.frameCount % 500 == 0){
                    entities.push(new Memory(1199, 280, 1));
                }
            }else if(GAME.frameCount < 8000 && GAME.frameCount > 7000){
                if(GAME.frameCount % 400 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new WhiteHead(1199, Math.random() * 550, 1));
                        entities.push(new BlackHead(1199, Math.random() * 550, 1));
                    }else{
                        entities.push(new WhiteHead(1199, 200 + Math.random() * 150, 1));
                        entities.push(new BlackHead(1199, 200 + Math.random() * 150, 1));
                    }
                }
            }else if(GAME.frameCount < 10000){
                if(GAME.frameCount % 300 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 2));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 2));
                    }
                }
                if(GAME.frameCount % 550 == 0){
                    entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 1));
                }
                if(GAME.frameCount % 500 == 0){
                    entities.push(new Memory(1199, 280, 1));
                }
                if(GAME.frameCount % 600 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new WhiteHead(1199, Math.random() * 550, 1));
                        entities.push(new BlackHead(1199, Math.random() * 550, 1));
                    }else{
                        entities.push(new WhiteHead(1199, 200 + Math.random() * 150, 1));
                        entities.push(new BlackHead(1199, 200 + Math.random() * 150, 1));
                    }
                }
            }
            if(GAME.frameCount == 10000){
                entities.push(new Blazer(1199, 260, 1));
            }
        }
    }else{
        if(GAME.level == 1){
            if(GAME.frameCount == 0){
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2,
                                "Stage 1 EX - Dark Forest", 50, [0, 0, 0], 150));
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2 + 50,
                                "BGM: ♪ [something something something] ♪", 20, [100, 100, 100], 150));
            }
            if(GAME.frameCount < 500){
                if(GAME.frameCount % 25 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 2));
                }
            }else if(GAME.frameCount < 1000){
                if(GAME.frameCount % 50 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 2));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 3));
                }
            }else if(GAME.frameCount < 2000){
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 3));
                }
            }else if(GAME.frameCount < 2500){
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 3));
                }
            }else if(GAME.frameCount < 3500){
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 750 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 3));
                }
            }else if(GAME.frameCount < 4500){
                if(GAME.frameCount % 100 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 650 == 200){
                    entities.push(new Raven(1199, Math.random() * 550, 3));
                }
            }else if(GAME.frameCount < 5500){
                if(GAME.frameCount % 600 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 3));
                }
            }else if(GAME.frameCount < 7500){
                if(GAME.frameCount % 500 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 3));
                }
            }else if(GAME.frameCount < 9000){
                if(GAME.frameCount % 500 == 0){
                    entities.push(new Raven(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 200 == 0){
                    entities.push(new Bat(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Lost(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 700 == 350){
                    entities.push(new Mirage(1199, Math.random() * 550, 3));
                }
                if(GAME.frameCount % 400 == 200){
                    entities.push(new CrossShot(1199, Math.random() * 550, 3));
                }
            }
            if(GAME.frameCount == 9000){
                entities.push(new DoomFairy(1199, 300, 3));
            }
        }else if(GAME.level == 2){
            if(GAME.frameCount == 0){
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2,
                                "Stage 2 — The Plague Nest", 50, [0, 0, 0], 150));
                entities.push(new Text(GAME.canvas.width/2, GAME.canvas.height/2 + 50,
                                "BGM: ♪ [something something] ♪", 20, [100, 100, 100], 150));
            }
            if(GAME.frameCount % 400 == 0){
                entities.push(new Wall(1199, 0, 200, 200, 1));
                entities.push(new Wall(1199,
                GAME.canvas.height - 200, 200, 200, 1));
            }
            if(GAME.frameCount < 500){
                if(GAME.frameCount % 50 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 3));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 3));
                    }
                }
            }else if(GAME.frameCount < 1500){
                if(GAME.frameCount % 200 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 3));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 3));
                    }
                }
            }else if(GAME.frameCount < 2500){
                if(GAME.frameCount % 250 == 0){
                    entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 3));
                }
            }else if(GAME.frameCount < 5000){
                if(GAME.frameCount % 350 == 0){
                    if(GAME.frameCount % 250 >= 100){
                        entities.push(new DemonShape(1199, Math.random() * 550, 3));
                    }else{
                        entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 3));
                    }
                }
                if(GAME.frameCount % 200 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 3));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 3));
                    }
                }
            }else if(GAME.frameCount < 5250){
                if(GAME.frameCount % 250 == 0){
                    entities.push(new Memory(1199, 280, 3));
                }
            }else if(GAME.frameCount < 6500){
                if(GAME.frameCount % 200 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 3));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 3));
                    }
                }
                if(GAME.frameCount % 400 == 0){
                    entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 3));
                }
                if(GAME.frameCount % 500 == 0){
                    entities.push(new Memory(1199, 280, 3));
                }
            }else if(GAME.frameCount < 8000 && GAME.frameCount > 7000){
                if(GAME.frameCount % 200 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new WhiteHead(1199, Math.random() * 550, 3));
                        entities.push(new BlackHead(1199, Math.random() * 550, 3));
                    }else{
                        entities.push(new WhiteHead(1199, 200 + Math.random() * 150, 3));
                        entities.push(new BlackHead(1199, 200 + Math.random() * 150, 3));
                    }
                }
            }else if(GAME.frameCount < 10000){
                if(GAME.frameCount % 300 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new Lost(1199, Math.random() * 550, 3));
                    }else{
                        entities.push(new Lost(1199, 200 + Math.random() * 150, 3));
                    }
                }
                if(GAME.frameCount % 550 == 0){
                    entities.push(new DemonShape(1199, 200 + Math.random() * (200 - 65), 3));
                }
                if(GAME.frameCount % 300 == 0){
                    entities.push(new Memory(1199, 280, 3));
                }
                if(GAME.frameCount % 400 == 0){
                    if(GAME.frameCount % 400 >= 100){
                        entities.push(new WhiteHead(1199, Math.random() * 550, 3));
                        entities.push(new BlackHead(1199, Math.random() * 550, 3));
                    }else{
                        entities.push(new WhiteHead(1199, 200 + Math.random() * 150, 3));
                        entities.push(new BlackHead(1199, 200 + Math.random() * 150, 3));
                    }
                }
            }
            if(GAME.frameCount == 10000){
                entities.push(new Blazer(1199, 260, 3));
            }
        }
    }
}
function main(){
    GAME.clear();
    GAME.context.fillStyle = "#FFFFFF";
    GAME.context.fillRect(-GAME.canvas.width * 3, -GAME.canvas.height * 3,
    GAME.canvas.width * 6, GAME.canvas.height * 6);
    player.centerPosition();
    player.update();
    for(var i in entities){
        if(entities[i] instanceof Entity){
            entities[i].update();
            entities[i].draw();
            entities[i].interact(player);
            if(entities[i] instanceof Bullet ||
            entities[i] instanceof Wall){
                for(var j in entities){
                    entities[i].interact(entities[j]);
                }
            }
            if(entities[i].dead){
                entities.splice(i, 1);
                i--;
            }
        }
    }
    drawForeground();
    spawnEntities();
    GAME.frameCount++;
}
//footer
        </script>
    </head>
    <body onload="init()">
        <div id="output"></div>
    </body>
</html>